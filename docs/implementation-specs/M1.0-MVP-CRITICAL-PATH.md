# M1.0 Critical Path Analysis (MVP vs. Validation)

**Date**: 2025-11-18
**Purpose**: Separate critical-path features from nice-to-have validation/observability
**User Context**: Deadline-driven delivery - functionality first, validation later

---

## Critical Path Priority Matrix

### üî¥ **M1.0 MVP** (MUST HAVE - Fixes FK Violations)
**Estimated Effort**: 1.5-2 days
**Deliverable**: Bootstrap snapshot solution that eliminates cross-module FK violations in SSDT

| Feature | Why Critical | Estimated Effort |
|---------|--------------|------------------|
| **Generate bootstrap snapshot** | Core solution to FK ordering problem | 1 day |
| `AllEntitiesIncludingStatic.bootstrap.sql` with global topological sort | Single file with ALL entities = no module ordering issues | |
| **Generate PostDeployment template** | Enables first-deployment bootstrap | 0.5 days |
| `PostDeployment-Bootstrap.sql` with guard logic | IF NOT EXISTS check on canonical static table | |
| **Directory rename** | Clearer terminology for baseline seeds | Included above |
| `Seeds/` ‚Üí `BaselineSeeds/` | Distinguishes baseline (version-controlled) from bootstrap (ephemeral) | |

**Architecture Notes**:
- Reuses existing `EntityDependencySorter` (no new sorting logic needed)
- Reuses existing `StaticSeedSqlBuilder` for MERGE generation
- SQLCMD `:r` includes preserve GO batching (no changes to LoadHarness)
- Bootstrap snapshot is gitignored (ephemeral, regenerated each export)
- Baseline seeds remain version-controlled (source of truth for static data)

**Success Criteria**:
1. ‚úÖ Bootstrap snapshot contains ALL entities in correct topological order
2. ‚úÖ PostDeployment template has guard logic (first deployment vs. subsequent)
3. ‚úÖ SSDT deployment succeeds without cross-module FK violations
4. ‚úÖ Baseline seeds work correctly on subsequent deployments (idempotent MERGE)

---

### üü° **M1.5** (Nice-to-Have - Production Enhancements)
**Estimated Effort**: 0.5 days
**Deliverable**: Per-table emission mode for fine-grained version control

| Feature | Why Deferred | When to Implement |
|---------|--------------|-------------------|
| **Per-table baseline seed emission** | Production convenience, not required for MVP | After M1.0 MVP proven |
| `BaselineSeeds/{Module}/{Table}.seed.sql` | Fine-grain version control for large apps | User can request if needed |
| **Dynamic PostDeployment includes** | Template adapts to single-file/per-module/per-table modes | Naturally extends M1.0 template generation |

**Migration Path**:
- M1.0 MVP defaults to single-file mode (`BaselineSeeds/StaticEntities.seed.sql`)
- M1.5 adds `EmitPerTableSeeds` configuration option
- PostDeployment template already designed to handle multiple files (forward-compatible)

---

### üü¢ **M1.6** (Observability - Defensive Measures)
**Estimated Effort**: 0.5 days
**Deliverable**: Diagnostic aids for troubleshooting bootstrap execution

| Feature | Why Deferred | When to Implement |
|---------|--------------|-------------------|
| **Explicit GO statements** | Existing MERGE scripts already have GO statements | If operators report batching issues |
| Between each entity in bootstrap snapshot | Defensive transaction boundaries | Can add retroactively |
| **Diagnostic PRINT statements** | Observability, not correctness | After M1.0 MVP if operators need visibility |
| Execution progress logging | Shows which entities completed | LoadHarness can be extended later |
| **Topological position comments** | Debugging aid in generated scripts | After M1.0 MVP if manual inspection needed |
| Shows dependency chain in SQL comments | Visual verification of order | Nice-to-have, not critical |

**Why Low Priority**:
- M1.0 MVP bootstrap snapshot WILL be correct (uses proven `EntityDependencySorter`)
- If FK violations still occur, they indicate environmental issues (e.g., disabled constraints)
- Diagnostic features help operators debug, but don't prevent issues

---

### üîµ **M1.7** (Verification - Topological Proof)
**Estimated Effort**: 2 days
**Deliverable**: Machine-readable proof that ordering is correct
**Deferred From**: M1.2 (entire spec moved here)

| Feature | Why Deferred | When to Implement |
|---------|--------------|-------------------|
| **ordering-proof.json** | Observability artifact, not functional requirement | After M1.0-M1.6 delivered |
| Machine-readable dependency graph | Enables automated verification | When CI/CD needs proof artifacts |
| **ordering-report.md** | Human-readable visualization | After M1.0-M1.6 delivered |
| Topological layers, dependency tree | Debugging aid, not critical path | When operators request it |
| **Violation detection** | Proves correctness, doesn't provide correctness | After M1.0-M1.6 delivered |
| Flags child-before-parent, cycles, missing parents | Safety check, not solution | Nice-to-have validation |

**Why Deferred**:
- M1.0 MVP uses existing `EntityDependencySorter` which is ALREADY PROVEN correct
- Proof generation is for verification, not implementation
- Can be added without changing M1.0 MVP behavior
- User has deadline - functionality first, proof later

**Integration Point**:
- M1.7 consumes `EntityDependencySortResult` from M1.0 bootstrap generation
- No changes to M1.0 code required (just reads existing data structures)
- Emits proof artifacts to `Proofs/` directory (new, independent)

---

### üîµ **M1.8+** (Verification - Data Integrity)
**Estimated Effort**: 4-5 days
**Deliverable**: Post-load verification (DMM replacement)
**Deferred From**: M1.3 (entire spec moved here)

| Feature | Why Deferred | When to Implement |
|---------|--------------|-------------------|
| **Source-to-target hash comparison** | Verification, not core functionality | After full-export is proven functional |
| HASHBYTES(SHA2_256) on all tables | DMM replacement goal | When user requests high-confidence data validation |
| **Row count verification** | Safety check, not requirement | After M1.0-M1.7 delivered |
| **NULL preservation checks** | Data quality validation | When production readiness demands it |
| **Data type conversion warnings** | Diagnostic output | Nice-to-have for operators |

**Why Deferred**:
- M1.0 MVP focuses on fixing FK violations (schema/ordering issue)
- M1.8 focuses on data correctness (content verification)
- Separate concerns: M1.0 = correct order, M1.8 = correct data
- User needs working full-export NOW, validation can come later

**Dependencies**:
- M1.8 depends on M1.0 (bootstrap snapshot must exist to verify)
- M1.8 optionally uses M1.7 (can reference topological proof for FK debugging)
- M1.8 is independent of M1.5-M1.6 (doesn't matter how seeds are emitted)

---

## Implementation Roadmap

### Sprint 1: Critical Path (M1.0 MVP)
**Goal**: Fix FK violations in SSDT deployment
**Duration**: 1.5-2 days

**Tasks**:
1. Create `BuildSsdtBootstrapSnapshotStep.cs`
   - Combine static + regular entities
   - Call `EntityDependencySorter.SortByForeignKeys()`
   - Generate MERGE script for all entities
   - Write to `Bootstrap/AllEntitiesIncludingStatic.bootstrap.sql`

2. Create `BuildSsdtPostDeploymentTemplateStep.cs`
   - Guard logic: `IF NOT EXISTS (SELECT 1 FROM [canonical_static_table])`
   - Bootstrap include: `:r Bootstrap\AllEntitiesIncludingStatic.bootstrap.sql`
   - Baseline seeds includes: `:r BaselineSeeds\StaticEntities.seed.sql` (or per-module)
   - Write to `PostDeployment-Bootstrap.sql`

3. Update directory structure
   - Rename `Seeds/` ‚Üí `BaselineSeeds/`
   - Create `Bootstrap/` directory (mark as gitignored)

4. Integration tests
   - Test bootstrap generation
   - Test PostDeployment template generation
   - Test SSDT deployment (if possible)

**Acceptance Criteria**:
- ‚úÖ `osm full-export` generates Bootstrap/ and PostDeployment-Bootstrap.sql
- ‚úÖ User can copy PostDeployment-Bootstrap.sql into SSDT project
- ‚úÖ First deployment applies bootstrap snapshot successfully
- ‚úÖ Subsequent deployments skip bootstrap, apply baseline seeds
- ‚úÖ No FK violations during SSDT deployment

---

### Sprint 2: Production Enhancements (M1.5)
**Goal**: Add per-table emission mode for production version control
**Duration**: 0.5 days
**Prerequisite**: M1.0 MVP shipped and proven

**Tasks**:
1. Add `EmitPerTableSeeds` configuration option to `StaticSeedOptions`
2. Implement per-table emission in `BuildSsdtStaticSeedStep.cs`
3. Update PostDeployment template to handle per-table mode (dynamic `:r` includes)
4. Tests for per-table emission and template generation

**Acceptance Criteria**:
- ‚úÖ `osm full-export --emit-per-table-seeds` creates `BaselineSeeds/{Module}/{Table}.seed.sql`
- ‚úÖ PostDeployment-Bootstrap.sql includes all per-table files
- ‚úÖ Backward compatible (default remains single-file mode)

---

### Sprint 3: Observability (M1.6)
**Goal**: Add diagnostic aids for operators
**Duration**: 0.5 days
**Prerequisite**: M1.0 MVP + M1.5 shipped
**Trigger**: Operator feedback requests visibility

**Tasks**:
1. Add explicit GO statements between entities in bootstrap snapshot
2. Add PRINT diagnostics for execution progress
3. Add topological position comments in generated scripts

**Acceptance Criteria**:
- ‚úÖ Bootstrap snapshot has clear entity boundaries
- ‚úÖ SSDT output shows execution progress
- ‚úÖ Operators can verify ordering by reading comments

---

### Sprint 4: Verification (M1.7 - Topological Proof)
**Goal**: Generate proof artifacts for ordering correctness
**Duration**: 2 days
**Prerequisite**: M1.0 MVP shipped
**Trigger**: User requests automated verification for CI/CD

**Tasks**:
1. Enhance `EntityDependencySortResult` with detailed metadata
2. Create `TopologicalProofGenerator`
3. Emit `ordering-proof.json` and `ordering-report.md`
4. Create `BuildSsdtOrderingProofStep.cs`

**Acceptance Criteria**:
- ‚úÖ `Proofs/ordering-proof.json` contains dependency graph
- ‚úÖ `Proofs/ordering-report.md` is human-readable
- ‚úÖ Violations detected and reported (if any)

---

### Sprint 5: Verification (M1.8 - Data Integrity)
**Goal**: DMM replacement - verify source-to-target data parity
**Duration**: 4-5 days
**Prerequisite**: M1.0 MVP + functional full-export
**Trigger**: User ready for production validation

**Tasks**:
1. Create `DataIntegrityVerificationOrchestrator`
2. Implement hash comparison, row count verification, NULL checks
3. Generate verification reports
4. Integrate with LoadHarness (optional wrapper)

**Acceptance Criteria**:
- ‚úÖ Post-load verification compares source vs. target
- ‚úÖ Reports show pass/fail per table
- ‚úÖ Operators have high confidence in data correctness

---

## Architectural Soundness Check

### M1.0 MVP Does NOT Block Future Work

**M1.5 Per-Table Emission**:
- ‚úÖ PostDeployment template ALREADY designed to handle multiple files
- ‚úÖ No changes to M1.0 bootstrap generation needed
- ‚úÖ Just adds a new emission mode option

**M1.6 Observability**:
- ‚úÖ Can add GO statements, PRINT, comments without changing M1.0 logic
- ‚úÖ Enhancements to generated scripts, not orchestration
- ‚úÖ Backward compatible (just adds more output)

**M1.7 Topological Proof**:
- ‚úÖ Consumes existing `EntityDependencySortResult` from M1.0
- ‚úÖ No changes to M1.0 code required
- ‚úÖ Just reads metadata and emits proof artifacts

**M1.8 Data Integrity**:
- ‚úÖ Verifies data loaded by M1.0 bootstrap snapshot
- ‚úÖ Completely independent orchestration step
- ‚úÖ Can reference M1.7 proof for debugging (optional)

### What We're NOT Doing (Good Decisions)

‚ùå **NOT changing dynamic data behavior** (user confirmed static entities already included)
‚ùå **NOT reimplementing topological sort** (reusing existing `EntityDependencySorter`)
‚ùå **NOT breaking existing exports** (M1.0 is purely additive)
‚ùå **NOT blocking on validation** (functionality first, proof later)
‚ùå **NOT over-engineering** (simple bootstrap snapshot solves the problem)

---

## Recommended Delivery Sequence

**Phase 1: Ship M1.0 MVP (This Week)**
- Fixes FK violations (critical blocker)
- Enables SSDT deployments to succeed
- User can test full-export workflow

**Phase 2: Ship M1.5 (Next Sprint)**
- Production-ready per-table emission
- User feedback on M1.0 incorporated
- Fine-grain version control for large apps

**Phase 3: Ship M1.6 (If Requested)**
- Only if operators report troubleshooting needs
- Observability enhancements
- Not blocking on functionality

**Phase 4: Ship M1.7 (When Ready for CI/CD)**
- Automated verification for builds
- Proof artifacts for auditing
- Nice-to-have for production readiness

**Phase 5: Ship M1.8 (DMM Replacement)**
- When user ready for high-confidence data validation
- Post-load verification
- Production requirement, not MVP blocker

---

## Decision: Restructure M1.x Numbering

**Current State**:
- M1.0 = Bootstrap snapshot (MVP)
- M1.1 = Export verification framework (separate concern)
- M1.2 = Topological proof (deferred)
- M1.3 = Data integrity (deferred)

**Proposed Restructure**:
- **M1.0 = Bootstrap Snapshot MVP** (ship this week)
- **M1.1 = Export Verification Framework** (unchanged, separate tracking)
- **M1.5 = Per-Table Emission** (production enhancement)
- **M1.6 = Observability Measures** (diagnostic aids)
- **M1.7 = Topological Proof** (formerly M1.2)
- **M1.8 = Data Integrity Verification** (formerly M1.3)

**Rationale**:
- M1.1 is independent (manifest/artifact verification, not data ordering)
- M1.0 is critical path (fixes FK violations)
- M1.5-M1.8 are enhancements/validation (can ship iteratively)
- Numbering reflects implementation priority

---

## Summary

**Ship NOW**: M1.0 MVP (bootstrap snapshot + PostDeployment template)
**Ship NEXT**: M1.5 (per-table emission if user requests)
**Ship LATER**: M1.6 (observability), M1.7 (proof), M1.8 (verification)

**Why This Works**:
1. ‚úÖ Fixes FK violations immediately (user's blocker)
2. ‚úÖ Enables SSDT deployments to succeed (functional requirement)
3. ‚úÖ Doesn't block on validation (ship functionality first)
4. ‚úÖ Architecturally sound (no rework needed for future enhancements)
5. ‚úÖ Meets deadline (M1.0 MVP is 1.5-2 days)
