# 16.7 Structural Changes

*These are significant refactorings that change how data is organized. Almost always multi-phase.*

---

### Split an Entity (Vertical Partitioning)

**Layer 1**
| Summary | Tier | Mechanism | CDC |
|---------|------|-----------|-----|
| Extract columns into a new related table | 4 | Multi-Phase | Both tables affected |

---

**Layer 2**

**Dimensions:**
| Dimension | Value | Reasoning |
|-----------|-------|-----------|
| Data Involvement | Data-transforming | Data moves between tables |
| Reversibility | Effortful | Can merge back, but requires scripted work |
| Dependency Scope | Cross-boundary | All queries/procs referencing those columns |
| Application Impact | Breaking | Query patterns must change |

---

**Layer 3: Gotchas & Edge Cases**

| Gotcha | Details |
|--------|---------|
| Application coordination | This is application-level refactoring. SSDT handles each step; you own orchestration. |
| Drop timing | Don't drop columns until application is fully transitioned. |

**Related:**
- Pattern: [17.6 Table Split](#176-pattern-table-split)

---

### Merge Entities (Denormalization)

**Layer 1**
| Summary | Tier | Mechanism | CDC |
|---------|------|-----------|-----|
| Combine two tables into one | 4 | Multi-Phase | Both tables affected |

---

**Layer 2**

Reverse of split. Same tier, same concerns.

**Phase sequence:**
1. Add columns to target table
2. Migrate data from source table
3. Application transitions
4. Drop source table

---

### Move an Attribute Between Entities

**Layer 1**
| Summary | Tier | Mechanism | CDC |
|---------|------|-----------|-----|
| Move a column from one table to another | 3-4 | Multi-Phase | Both tables affected |

---

**Layer 2**

**Phase sequence:**
1. Add column to destination table
2. Migrate data
3. Application transitions
4. Drop from source table

---

### Move an Entity Between Schemas

**Layer 1**
| Summary | Tier | Mechanism | CDC |
|---------|------|-----------|-----|
| Move a table to a different schema namespace | 3 | Declarative + Refactorlog OR Script | Instance recreation required |

---

**Layer 2**

**SSDT approach:**

Change the schema in the file:
```sql
CREATE TABLE [archive].[AuditLog]  -- was [dbo].[AuditLog]
```

Use refactorlog to express the move, otherwise SSDT drops and recreates.

**Script approach (preserves object_id):**
```sql
ALTER SCHEMA archive TRANSFER dbo.AuditLog
```

---

**Layer 3: Gotchas & Edge Cases**

| Gotcha | Details |
|--------|---------|
| Refactorlog | Without it, SSDT interprets as drop + create. |
| ALTER SCHEMA TRANSFER | Single operation, preserves object_id and data. May be preferable. |
| References | All fully-qualified references break. |

**Related:**
- Pattern: [17.8 Schema Migration with Backward Compatibility](#178-pattern-schema-migration-with-backward-compatibility)

---
